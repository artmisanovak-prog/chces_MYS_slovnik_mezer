<!DOCTYPE html>
<html lang="cs">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ± KOCOUR â€“ diagnostickÃ½ mÃ³d</title>
    <style>
        /* ZÃKLAD â€“ ÄŒERNOBÃLÃ, JEN PUNTÃKY BAREVNÃ‰ */
        * { box-sizing: border-box; margin: 0; padding: 0; }
        body {
            background: #fff;
            color: #000;
            font-family: 'Courier New', Courier, monospace;
            line-height: 1.5;
            padding: 2rem 1rem;
            display: flex;
            justify-content: center;
        }
        .container {
            max-width: 1000px;
            width: 100%;
            border: 3px solid #000;
            padding: 2rem;
            background: #fff;
        }

        /* TYPOGRAFIE */
        h1 { font-size: 2.2rem; font-weight: 700; margin-bottom: 1.5rem; border-bottom: 3px solid #000; padding-bottom: 0.5rem; }
        h2 { font-size: 1.8rem; margin: 2rem 0 1rem; }
        h3 { font-size: 1.4rem; margin: 1.5rem 0 0.8rem; }
        hr { border: none; border-top: 2px solid #000; margin: 2rem 0; }

        /* KROKY */
        .step { display: none; }
        .step.active { display: block; }

        /* TLAÄŒÃTKA */
        .btn {
            background: #000;
            color: #fff;
            border: 2px solid #000;
            padding: 0.7rem 1.8rem;
            font-family: inherit;
            font-weight: bold;
            font-size: 1.1rem;
            cursor: pointer;
            margin: 1rem 0.5rem 1rem 0;
            transition: none;
        }
        .btn:hover { background: #fff; color: #000; }
        .btn:disabled, .btn.hotovo {
            background: #ccc;
            color: #666;
            border-color: #666;
            cursor: default;
        }
        .btn.hotovo:hover { background: #ccc; color: #666; }

        /* FORMULÃÅ˜E */
        input, textarea {
            width: 100%;
            padding: 0.8rem;
            border: 2px solid #000;
            background: #fff;
            font-family: inherit;
            font-size: 1rem;
            margin: 0.3rem 0;
        }
        textarea { min-height: 80px; resize: vertical; }
        label { font-weight: bold; display: block; margin-top: 1rem; }

        /* BAREVNÃ‰ PUNTÃKY â€“ vÃ½bÄ›r */
        .barvy-volba {
            display: flex;
            gap: 0.8rem;
            margin: 0.5rem 0;
            flex-wrap: wrap;
        }
        .barva-polozka {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            border: 2px solid #000;
            cursor: pointer;
        }
        .barva-polozka.vybrana { border: 4px solid #000; outline: 2px solid #fff; outline-offset: 0; }

        /* SEZNAM LIDÃ */
        .clen-seznam { margin: 1.5rem 0; }
        .clen-polozka {
            display: flex;
            align-items: center;
            gap: 1rem;
            margin: 1rem 0;
            padding: 0.8rem;
            border: 2px solid #000;
            background: #f9f9f9;
        }
        .clen-barva {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            border: 2px solid #000;
            flex-shrink: 0;
        }
        .clen-jmeno { font-weight: bold; min-width: 120px; }
        .clen-odpoved { flex: 1; }
        .clen-tlacitko { min-width: 100px; }

        /* POHÃDKA â€“ SCROLL OKNO */
        .pohadka-box {
            max-height: 300px;
            overflow-y: auto;
            border: 2px solid #000;
            padding: 1.5rem;
            margin: 1.5rem 0;
            background: #f5f5f5;
            white-space: pre-line;
            font-style: italic;
        }

        /* GRAF â€“ VÃSLEDKY */
        .graf-radky { margin: 2rem 0; }
        .graf-radek {
            display: grid;
            grid-template-columns: 200px 1fr 80px;
            gap: 1rem;
            align-items: center;
            margin: 0.8rem 0;
        }
        .graf-nazev { font-weight: bold; }
        .graf-sloupec {
            height: 28px;
            background: #ddd;
            border: 2px solid #000;
        }
        .graf-sloupec .fill {
            height: 100%;
            background: #000;
        }
        .graf-sloupec .fill.deficit { background: #aaa; }  /* svÄ›tlejÅ¡Ã­ Å¡edÃ¡ = deficit */
        .graf-sloupec .fill.premnozeny { background: #000; } /* ÄernÃ¡ = pÅ™etÃ­Å¾enÃ½ */
        .graf-skore { font-family: monospace; }

        .doporuceni {
            margin: 2rem 0;
            padding: 1.5rem;
            border: 2px solid #000;
            background: #f5f5f5;
        }
        .doporuceni-item {
            margin: 1.5rem 0;
            padding-left: 1rem;
            border-left: 6px solid #000;
        }

        .poznamka { font-size: 0.9rem; color: #333; margin: 1rem 0; }

        @media (max-width: 700px) {
            .graf-radek { grid-template-columns: 1fr; }
            .clen-polozka { flex-direction: column; align-items: flex-start; }
        }
    </style>
</head>
<body>
<div class="container">
    <h1>ğŸ± KOCOUR â€“ diagnostickÃ½ mod</h1>
    <p><a href="./README.md" style="color:#000; text-decoration:underline;">â† zpÄ›t na rozcestnÃ­k</a></p>
    <hr>

    <!-- KROK 1: POÄŒET LIDÃ -->
    <div id="step1" class="step active">
        <h2>Krok 1: Kolik vÃ¡s je?</h2>
        <p>Zadejte poÄet ÄlenÅ¯ tÃ½mu, kteÅ™Ã­ se diagnostiky ÃºÄastnÃ­.</p>
        <input type="number" id="pocetLidi" min="1" max="20" value="3">
        <button class="btn" onclick="krok1Potvrdit()">Potvrdit</button>
    </div>

    <!-- KROK 2: JMÃ‰NA A BARVY -->
    <div id="step2" class="step">
        <h2>Krok 2: JmÃ©na a rozliÅ¡enÃ­</h2>
        <p>Ke kaÅ¾dÃ©mu doplÅˆte jmÃ©no a vyberte barvu puntÃ­ku (kliknutÃ­m).</p>
        <div id="cleniKrok2"></div>
        <button class="btn" onclick="krok2Pokracovat()">PokraÄovat</button>
    </div>

    <!-- KROK 3: POHÃDKA + ODPOVÄšDI -->
    <div id="step3" class="step">
        <h2>Krok 3: PohÃ¡dka a vaÅ¡e postÅ™ehy</h2>

        <!-- POHÃDKA (TRVALE VIDITELNÃ) -->
        <div class="pohadka-box" id="pohadkaText"></div>

        <!-- SEZNAM ODPOVÄšDÃ -->
        <div id="cleniKrok3"></div>

        <!-- TLAÄŒÃTKO VYHODNOTIT (objevÃ­ se aÅ¾ po vÅ¡ech odpovÄ›dÃ­ch) -->
        <div id="vyhodnotitContainer" style="display:none;">
            <button class="btn" onclick="vyhodnotit()">Vyhodnotit â†’</button>
        </div>
    </div>

    <!-- KROK 4: VÃSLEDKY + GRAF -->
    <div id="step4" class="step">
        <h2>Krok 4: DiagnostickÃ½ ÃºhlomÄ›r</h2>
        <p>Na zÃ¡kladÄ› vaÅ¡ich odpovÄ›dÃ­ jsme sestavili profil tÃ½mu.</p>

        <!-- GRAF -->
        <div id="grafContainer" class="graf-radky"></div>

        <!-- DOPORUÄŒENÃ -->
        <div id="doporuceniContainer" class="doporuceni"></div>

        <!-- ULOÅ½ENÃ -->
        <button class="btn" onclick="ulozVysledky()">ğŸ’¾ UloÅ¾it vÃ½sledky (s datem/Äasem)</button>
        <button class="btn" onclick="novaDiagnostika()">âŸ² NovÃ¡ diagnostika</button>
        <p class="poznamka">VÃ½sledky obsahujÃ­ jmÃ©na, odpovÄ›di, graf a doporuÄenÃ­.</p>
    </div>

    <hr>
    <p style="text-align:center;">Â© KOCOUR â€“ diagnostickÃ½ mod (souÄÃ¡st systÃ©mu ChceÅ¡ myÅ¡? SlovnÃ­k mezer)</p>
</div>

<script>
// ----------------------------------------------------------------
// DATA â€“ POHÃDKA, 12 ÃšHLÅ®, KLÃÄŒOVÃ SLOVA (PÅ˜ESNÄš PODLE TVÃ‰ TABULKY)
// ----------------------------------------------------------------
const POHADKA = `O kocourovi, kterÃ½ seÅ¾ral dvÄ› beruÅ¡ky a pÅ¯l hodiny krkal teÄky

SleÅ¾ral dvÄ› â€“ ne tÅ™i, ne jednu â€“ dvÄ› â€“ pÅ™esnÄ› â€“ 14 teÄek a trvalo to pÅ¯l hodiny â€“ 30 minut â€“ pÅ™esnÄ›. 
Jak to pÅ™iÅ¡lo, tak to pÅ™estalo. RÃ¡z na rÃ¡z.

ChÅˆap a hlt a chlamst â€“ nebo nÄ›co takovÃ©ho a nakonec â€“ mlask, mlask â€“ dvakrÃ¡t â€“ pÅ™esnÄ›.

Å½ily byly dvÄ› beruÅ¡ky, kaÅ¾dÃ¡ sedm teÄek mÄ›la, kdyÅ¾ uvidÄ›l je jeden kocour byla to mela. AspoÅˆ pro nÄ›.

Po 14ti teÄkÃ¡ch v jednom mÅ¾iku zem se slehla. RozhodnÄ› aspoÅˆ kocour se svÃ½mi Ãºtrobami.

Ale ta myÅ¡, vÅ¾dycky zvÄ›davÃ¡ byla. OdmaliÄka chodÃ­vala a kde mohla se vyptÃ¡vala, kde se teÄky na beruÅ¡kÃ¡ch vzaly? K Äemu je maji? ProÄ si radÅ¡i nevytvoÅ™Ã­ pravÃ½ maskovÃ¡nÃ­?

A ta pÅ™esnÃ¡ matika.. Kdo vlastnÄ› z tÄ›ch, co s nimi pÅ™ijdou do styku, takhle pÅ™esnÄ› poÄÃ­tÃ¡?

No a toho dne â€“ nÃ¡hle â€“ se to stalo a myÅ¡ svou odpovÄ›Ä mÄ›la. Kocour mlaskl a pak znovu a hned na to zaÄalo to.

PÅ¯l hodiny a bylo to zaznamenÃ¡no â€“ pÅ™esnÄ›. Kocour krkal teÄky a dokonÄoval vÄ›ty! NÄ›kdy celÃ© souvÄ›tÃ­!!

JenomÅ¾e tÃ­m zÃ¡roveÅˆ skÃ¡kal lidem do Å™eÄi, tÃ­m Å¾e za nÄ› dokonÄoval, co nedokonÄili. SkoÄil vÅ¡em do Å™eÄi koncem vÄ›ty â€“ ale vÅ¾dycky o nÄ›co mÃ¡lo, nÄ›kdy i o docela dost dÅ™Ã­v, neÅ¾ mÄ›la vÄ›ta pÅ¯vodnÄ› skonÄit.

A celou pÅ¯lhodinu nemohl tenkrÃ¡t nikdo nic â€“ ne â€“ dokonÄit. NeÅ¡lo to. KaÅ¾dÃ©mu dÅ™Ã­v, neÅ¾ se k tomu dostal, vÅ¡em kocour vÄ›tu ukonÄil. Hned.

Kocour se tomu smÃ¡l, ale krkal dÃ¡l. A krkal, dokud neskonÄil. PÅ™edstavte si to: SkonÄil vÄ›tu a pak skonÄil krkat.

A lidÃ© zase zaÄali moct svÃ© vÄ›ty ukonÄovat sami. Hned.

JenÅ¾e, jak se to tak obÄas stÃ¡vÃ¡, pÅ™estoÅ¾e nikdo nevÄ›dÄ›l co, kaÅ¾dÃ½ vÄ›dÄ›l, Å¾e nÄ›co nebylo stejnÃ©. A to, co jednou nenÃ­ stejnÃ© dnes, to nenÃ­ jednou stejnÃ© nikdy.

Jen nedokonÄenÃ© vÄ›ty bÃ½vajÃ­ vÅ¡echny stejnÃ©. Jednou, dnes i zÃ­tra. BeruÅ¡ky majÃ­ na sobÄ› nedokonÄenÃ© konce vÄ›t. VÄ›ci, kterÃ© jsou nespolknutÃ©.

Kocour to nevÄ›dÄ›l â€“ a dvÄ› spolknul. SpolknutÃ© konce ale vykrkal zpÃ¡tky a lide se nauÄili, Å¾e vÅ¡echno se spolknout nedÃ¡. A Å¾e teÄka je nÄ›kdy silnÄ›jÅ¡Ã­, neÅ¾ celÃ¡ vÄ›ta.

Kocour se naÅ¾ral a myÅ¡ i vÄ›ty zÅ¯stali celÃ©. DÃ­ky bohu za to. Å tÄ›stÃ­ dvou beruÅ¡ek se vrÃ¡tilo zpÃ¡tky.

Ale vÅ¡imly si toho jen kocour a malÃ¡ myÅ¡. A ani jeden neÅ™Ã­kali nic.

KONEC`;

// 12 ÃšHLÅ® â€“ PÅ˜ESNÄš Z TVÃ‰ TABULKY
const UHLY = [
    {
        nazev: "1. ABSURDNÃ ÃšHEL (Logika naruby)",
        q3: "Radil by nedÄ›lat vÄ›ci jen proto, Å¾e 'se to tak dÄ›lÃ¡', pokud to nedÃ¡vÃ¡ smysl.",
        klicSlova: ["rozpor", "paradox", "nesmysl", "absurdita", "pravidla", "logika", "smysl", "dÃ¡vÃ¡ smysl"]
    },
    {
        nazev: "2. JAZYKOVÃ ÃšHEL (Hra se slovy)",
        q3: "Radil by peÄlivÄ› volit slova, hrÃ¡t si s formulacemi nebo naslouchat skrytÃ½m vÃ½znamÅ¯m.",
        klicSlova: ["slovo", "vÄ›ta", "jazyk", "formulace", "Å™Ã­kÃ¡", "napsÃ¡no", "Äte", "vyprÃ¡vÃ­", "otÃ¡zka", "odpovÄ›Ä"]
    },
    {
        nazev: "3. IRONICKÃ ÃšHEL (PÅ™evrÃ¡cenÃ­ v smÄ›Å¡nÃ©)",
        q3: "Radil by se pÅ™i kaÅ¾dÃ©m rozhodnutÃ­ zeptat: 'A co kdyÅ¾ to dopadne pÅ™esnÄ› naopak, neÅ¾ chceme?'",
        klicSlova: ["ironie", "paradox", "trapnÃ½", "vtip", "smÄ›Å¡nÃ©", "legraÄnÃ­", "pobavilo", "humor", "sarkasmus"]
    },
    {
        nazev: "4. FILOZOFICKÃ ÃšHEL (ExistenciÃ¡lnÃ­ otÃ¡zky)",
        q3: "Radil by se vÅ¾dy nejdÅ™Ã­v zeptat: 'JakÃ½ je smysl toho, co dÄ›lÃ¡me? Je to opravdu dÅ¯leÅ¾itÃ©?'",
        klicSlova: ["smysl", "existence", "bytÃ­", "pravda", "universÃ¡lnÃ­", "otÃ¡zka", "podstata", "hodnota", "filozofie"]
    },
    {
        nazev: "5. SURREALISTICKÃ ÃšHEL (VolnÃ© asociace)",
        q3: "Radil by pÅ™i brainstormu zakÃ¡zat logiku a nechat pracovat pouze asociace a sny.",
        klicSlova: ["sen", "obraz", "asociace", "bizarnÃ­", "snovÃ½", "podivnÃ½", "fantazie", "nereÃ¡lnÃ½", "surreal"]
    },
    {
        nazev: "6. NAIVNÃ ÃšHEL (DÄ›tskÃ¡ logika)",
        q3: "Radil by se vÅ¾dy zeptat: 'Jak by to udÄ›lalo dÃ­tÄ›?'",
        klicSlova: ["jednoduchÃ½", "pÅ™Ã­moÄarÃ½", "ÄistÃ½", "dÃ­tÄ›", "dÄ›tskÃ½", "naivnÃ­", "prostÃ½", "morÃ¡lka", "pouÄenÃ­"]
    },
    {
        nazev: "7. INTROSPEKTIVNÃ ÃšHEL (VnitÅ™nÃ­ monolog)",
        q3: "Radil by si pÅ™ed kaÅ¾dÃ½m rozhodnutÃ­m dÃ¡t minutu ticha a zeptat se sÃ¡m sebe, co k tomu skuteÄnÄ› cÃ­tÃ­m.",
        klicSlova: ["cÃ­tÃ­m", "pocit", "emoce", "dotklo", "dojal", "vnitÅ™nÃ­", "osobnÃ­", "vzpomÃ­nka", "srdce"]
    },
    {
        nazev: "8. VÅ EOBECNÃ (KONKRÃ‰TNÃ) ÃšHEL (Co vidÃ­Å¡, to je)",
        q3: "Radil by nejdÅ™Ã­v sepsat vÅ¡echny znÃ¡mÃ© fakta o problÃ©mu, neÅ¾ zaÄneme spekulovat.",
        klicSlova: ["fakt", "dÄ›j", "stalo", "popis", "konkrÃ©tnÃ­", "jasnÃ½", "pÅ™esnÃ½", "vidÄ›t", "doslova"]
    },
    {
        nazev: "9. ANALOGICKÃ (KULTURNÃ) ÃšHEL (Vztahy, archetypy)",
        q3: "Radil by se podÃ­vat, jestli podobnÃ½ problÃ©m nemÄ›li v jinÃ©m oddÄ›lenÃ­ nebo firmÄ›, a pouÄit se z toho.",
        klicSlova: ["archetyp", "mÃ½tus", "symbol", "kultura", "historie", "podobnÃ½", "paralela", "analogie", "jako"]
    },
    {
        nazev: "10. ASOCIAÄŒNÃ ÃšHEL (RychlÃ© spojenÃ­)",
        q3: "Radil by pÅ™i hledÃ¡nÃ­ Å™eÅ¡enÃ­ napsat prvnÃ­ch 10 slov, co vÃ¡s napadnou, a teprve pak je analyzovat.",
        klicSlova: ["pÅ™ipomÃ­nÃ¡", "asociace", "napadÃ¡", "spojenÃ­", "vzpomnÄ›l", "evokuje", "podobnÃ©", "jako kdyÅ¾"]
    },
    {
        nazev: "11. METAFORICKÃ (SYMBOLICKÃ) ÃšHEL (Obraz â†’ vÃ½znam)",
        q3: "Radil by si problÃ©m nakreslit jako symbol nebo znak a pak se ptÃ¡t, co ten znak znamenÃ¡.",
        klicSlova: ["symbol", "metafora", "znamenÃ¡", "pÅ™edstavuje", "skrytÃ½", "vÃ½znam", "obraz", "deÅ¡ifrovat"]
    },
    {
        nazev: "12. GROTESKNÃ ÃšHEL (KomickÃ© do extrÃ©mu)",
        q3: "Radil by si pÅ™edstavit, Å¾e nÃ¡Å¡ problÃ©m je scÃ©nÃ¡Å™ pro Å¡patnÃ½ komiks, a napsat k nÄ›mu tÅ™i nejtrapnÄ›jÅ¡Ã­ pointy.",
        klicSlova: ["pÅ™ehnanÃ½", "karikatura", "trapnÃ½", "extrÃ©m", "vtip", "komickÃ½", "groteska", "bizarnÃ­", "smÄ›Å¡nÃ½"]
    }
];

// ----------------------------------------------------------------
// STAV APLIKACE
let pocet = 3;
let clenove = []; // pole objektÅ¯ { jmeno, barva, odpoved, hotovo }

// Paleta barev (pro puntÃ­ky)
const BARVY = ['#e61919', '#1e7e1e', '#1e1ec0', '#ff8c00', '#b469b4', '#00a1a1', '#a0522d', '#808080'];

// ----------------------------------------------------------------
// KROK 1
function krok1Potvrdit() {
    pocet = parseInt(document.getElementById('pocetLidi').value);
    if (isNaN(pocet) || pocet < 1) { alert('Zadejte platnÃ½ poÄet (alespoÅˆ 1).'); return; }
    if (pocet > 20) { alert('MaximÃ¡lnÄ› 20 lidÃ­.'); return; }

    // Inicializace pole ÄlenÅ¯
    clenove = [];
    for (let i = 0; i < pocet; i++) {
        clenove.push({
            jmeno: '',
            barva: BARVY[i % BARVY.length],
            odpoved: '',
            hotovo: false
        });
    }
    zobrazKrok2();
}

// ----------------------------------------------------------------
// KROK 2
function zobrazKrok2() {
    document.querySelectorAll('.step').forEach(s => s.classList.remove('active'));
    document.getElementById('step2').classList.add('active');

    let html = '';
    for (let i = 0; i < pocet; i++) {
        html += `
            <div class="clen-polozka" id="clen2-${i}">
                <div class="clen-barva" style="background:${clenove[i].barva};"></div>
                <div style="flex:1;">
                    <input type="text" id="jmeno-${i}" placeholder="JmÃ©no Älena" value="${clenove[i].jmeno}">
                    <div class="barvy-volba" id="barvy-${i}">
                        ${BARVY.map((b, idx) => `<div class="barva-polozka ${b === clenove[i].barva ? 'vybrana' : ''}" style="background:${b};" onclick="vybratBarvu(${i}, '${b}')"></div>`).join('')}
                    </div>
                </div>
            </div>
        `;
    }
    document.getElementById('cleniKrok2').innerHTML = html;
}

function vybratBarvu(index, barva) {
    clenove[index].barva = barva;
    // pÅ™ekreslÃ­me vÃ½bÄ›r barev pro tohoto Älena (aktualizace tÅ™Ã­dy vybrana)
    let container = document.getElementById(`barvy-${index}`);
    if (container) {
        let puntiky = container.children;
        for (let p of puntiky) {
            p.classList.remove('vybrana');
            if (p.style.background === barva) p.classList.add('vybrana');
        }
    }
    document.getElementById(`clen2-${index}`).querySelector('.clen-barva').style.background = barva;
}

function krok2Pokracovat() {
    // UloÅ¾it jmÃ©na z inputÅ¯
    for (let i = 0; i < pocet; i++) {
        let input = document.getElementById(`jmeno-${i}`);
        clenove[i].jmeno = input.value.trim() || `ÄŒlen ${i+1}`;
    }
    zobrazKrok3();
}

// ----------------------------------------------------------------
// KROK 3
function zobrazKrok3() {
    document.querySelectorAll('.step').forEach(s => s.classList.remove('active'));
    document.getElementById('step3').classList.add('active');

    document.getElementById('pohadkaText').innerText = POHADKA;

    let html = '';
    for (let i = 0; i < pocet; i++) {
        let disabledAttr = clenove[i].hotovo ? 'disabled' : '';
        html += `
            <div class="clen-polozka" id="clen3-${i}">
                <div class="clen-barva" style="background:${clenove[i].barva};"></div>
                <div class="clen-jmeno">${clenove[i].jmeno}</div>
                <div class="clen-odpoved">
                    <textarea id="odpoved-${i}" placeholder="Co vÃ¡s v textu zaujalo?" ${disabledAttr}>${clenove[i].odpoved}</textarea>
                </div>
                <div class="clen-tlacitko">
                    <button class="btn ${clenove[i].hotovo ? 'hotovo' : ''}" id="btn-${i}" onclick="potvrditOdpoved(${i})" ${disabledAttr}>${clenove[i].hotovo ? 'Hotovo' : 'Hotovo?'}</button>
                </div>
            </div>
        `;
    }
    document.getElementById('cleniKrok3').innerHTML = html;

    // Schovat/zobrazit tlaÄÃ­tko pro vyhodnocenÃ­
    document.getElementById('vyhodnotitContainer').style.display = (clenove.every(c => c.hotovo)) ? 'block' : 'none';
}

function potvrditOdpoved(index) {
    let textarea = document.getElementById(`odpoved-${index}`);
    clenove[index].odpoved = textarea.value;
    clenove[index].hotovo = true;

    // Deaktivovat a oznaÄit tlaÄÃ­tko
    let btn = document.getElementById(`btn-${index}`);
    btn.disabled = true;
    btn.classList.add('hotovo');
    btn.innerText = 'Hotovo';

    // Zkontrolovat, jestli vÅ¡ichni hotovi
    if (clenove.every(c => c.hotovo)) {
        document.getElementById('vyhodnotitContainer').style.display = 'block';
    }
}

// ----------------------------------------------------------------
// KROK 4 â€“ VYHODNOCENÃ
function vyhodnotit() {
    // SesbÃ­rat odpovÄ›di (pro jistotu znovu z textareÃ­, kdyby nÄ›kdo nÄ›co mÄ›nil)
    for (let i = 0; i < pocet; i++) {
        let ta = document.getElementById(`odpoved-${i}`);
        if (ta) clenove[i].odpoved = ta.value;
    }

    // Spojit vÅ¡echny odpovÄ›di do jednoho textu (pro hledÃ¡nÃ­ klÃ­ÄovÃ½ch slov)
    let vsechnyTexty = clenove.map(c => c.odpoved.toLowerCase()).join(' ');

    // SpoÄÃ­tat skÃ³re pro kaÅ¾dÃ½ Ãºhel
    let skore = UHLY.map(u => {
        let count = 0;
        u.klicSlova.forEach(slovo => {
            let regex = new RegExp(slovo, 'gi');
            let matches = vsechnyTexty.match(regex);
            if (matches) count += matches.length;
        });
        return count;
    });

    // UrÄit hranice pro "pÅ™etÃ­Å¾enÃ½" a "deficitnÃ­"
    // JednoduchÃ¡ metoda: seÅ™adit, hornÃ­ch 25 % = pÅ™etÃ­Å¾enÃ©, dolnÃ­ch 25 % = deficitnÃ­
    let sorted = [...skore].sort((a,b) => a - b);
    let deficitHranice = sorted[Math.floor(sorted.length * 0.25)]; // dolnÃ­ kvartil
    let premnozenaHranice = sorted[Math.ceil(sorted.length * 0.75)]; // hornÃ­ kvartil

    // VytvoÅ™it pole s typy
    let typy = skore.map(s => {
        if (s >= premnozenaHranice && premnozenaHranice > 0) return 'premnozeny';
        else if (s <= deficitHranice && deficitHranice > 0 && s > 0) return 'deficit';
        else return 'normal';
    });

    // Vykreslit graf
    let grafHtml = '';
    for (let i = 0; i < UHLY.length; i++) {
        let maxSkore = Math.max(...skore, 1); // aby se dalo dÄ›lit
        let sirka = (skore[i] / maxSkore) * 100;
        let trida = typy[i] === 'premnozeny' ? 'premnozeny' : (typy[i] === 'deficit' ? 'deficit' : '');
        grafHtml += `
            <div class="graf-radek">
                <div class="graf-nazev">${UHLY[i].nazev}</div>
                <div class="graf-sloupec">
                    <div class="fill ${trida}" style="width: ${sirka}%;"></div>
                </div>
                <div class="graf-skore">${skore[i]}</div>
            </div>
        `;
    }
    document.getElementById('grafContainer').innerHTML = grafHtml;

    // Vykreslit doporuÄenÃ­ (jen pro pÅ™etÃ­Å¾enÃ© a deficitnÃ­)
    let dopHtml = '<h3>ğŸ“Œ DoporuÄenÃ­ z Q3</h3>';
    for (let i = 0; i < UHLY.length; i++) {
        if (typy[i] !== 'normal') {
            let typText = typy[i] === 'premnozeny' ? 'ğŸ”´ PÅ˜ETÃÅ½ENÃ' : 'ğŸŸ¢ DEFICITNÃ';
            dopHtml += `
                <div class="doporuceni-item">
                    <strong>${typText}: ${UHLY[i].nazev}</strong><br>
                    ${UHLY[i].q3}
                </div>
            `;
        }
    }
    document.getElementById('doporuceniContainer').innerHTML = dopHtml;

    // Zobrazit krok 4
    document.querySelectorAll('.step').forEach(s => s.classList.remove('active'));
    document.getElementById('step4').classList.add('active');
}

// ----------------------------------------------------------------
// ULOÅ½ENÃ VÃSLEDKÅ®
function ulozVysledky() {
    let d = new Date();
    let datumCas = `${d.toLocaleDateString()} ${d.toLocaleTimeString()}`;

    let text = `VÃSLEDKY DIAGNOSTIKY â€“ KOCOUR\n`;
    text += `Datum a Äas: ${datumCas}\n`;
    text += `ÄŒlenovÃ© tÃ½mu:\n`;
    clenove.forEach(c => text += `- ${c.jmeno} (barva)\n`);
    text += `\nODPOVÄšDI NA OTÃZKU "Co vÃ¡s zaujalo?":\n`;
    clenove.forEach(c => text += `${c.jmeno}: ${c.odpoved}\n`);

    text += `\nSKÃ“RE ÃšHLÅ®:\n`;
    // tady bychom museli znovu spoÄÃ­tat skÃ³re â€“ pro jednoduchost zopakujeme vÃ½poÄet
    let vsechnyTexty = clenove.map(c => c.odpoved.toLowerCase()).join(' ');
    let skore = UHLY.map(u => {
        let count = 0;
        u.klicSlova.forEach(slovo => {
            let regex = new RegExp(slovo, 'gi');
            let matches = vsechnyTexty.match(regex);
            if (matches) count += matches.length;
        });
        return count;
    });
    for (let i = 0; i < UHLY.length; i++) {
        text += `${UHLY[i].nazev}: ${skore[i]}\n`;
    }

    text += `\nDOPORUÄŒENÃ Z Q3 (pro pÅ™etÃ­Å¾enÃ©/deficitnÃ­ Ãºhly):\n`;
    // opÄ›t bychom potÅ™ebovali typy â€“ zjednoduÅ¡enÄ› zopakujeme logiku
    let sorted = [...skore].sort((a,b) => a - b);
    let deficitHranice = sorted[Math.floor(sorted.length * 0.25)];
    let premnozenaHranice = sorted[Math.ceil(sorted.length * 0.75)];
    for (let i = 0; i < UHLY.length; i++) {
        if (skore[i] >= premnozenaHranice && premnozenaHranice > 0) {
            text += `ğŸ”´ PÅ˜ETÃÅ½ENÃ: ${UHLY[i].nazev} â€“ ${UHLY[i].q3}\n`;
        } else if (skore[i] <= deficitHranice && deficitHranice > 0 && skore[i] > 0) {
            text += `ğŸŸ¢ DEFICITNÃ: ${UHLY[i].nazev} â€“ ${UHLY[i].q3}\n`;
        }
    }

    const blob = new Blob([text], { type: 'text/plain;charset=utf-8' });
    const a = document.createElement('a');
    a.href = URL.createObjectURL(blob);
    a.download = `kocour_diagnostika_${d.toISOString().slice(0,19).replace(/:/g, '-')}.txt`;
    a.click();
}

// ----------------------------------------------------------------
// NOVÃ DIAGNOSTIKA
function novaDiagnostika() {
    // Reset stavu
    pocet = 3;
    clenove = [];
    document.getElementById('pocetLidi').value = 3;
    document.querySelectorAll('.step').forEach(s => s.classList.remove('active'));
    document.getElementById('step1').classList.add('active');
}

// ----------------------------------------------------------------
// PÅ˜I NAÄŒTENÃ STRÃNKY â€“ zobrazenÃ­ pohÃ¡dky v data (pro jistotu)
document.getElementById('pohadkaText').innerText = POHADKA;
</script>
</body>
</html>
