
    <!DOCTYPE html>
<html lang="cs">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ± KOCOUR â€“ diagnostickÃ½ mÃ³d</title>
    <style>
        /* ÄŒistÄ› ÄernobÃ­lÃ©, jen ikony jsou barevnÃ© (emoji) */
        * { box-sizing: border-box; margin: 0; padding: 0; }
        body {
            background: #fff;
            color: #000;
            font-family: 'Courier New', Courier, monospace;
            line-height: 1.5;
            padding: 2rem 1rem;
            display: flex;
            justify-content: center;
        }
        .container {
            max-width: 1000px;
            width: 100%;
            border: 3px solid #000;
            padding: 2rem;
            background: #fff;
        }

        h1 { font-size: 2.2rem; font-weight: 700; margin-bottom: 1.5rem; border-bottom: 3px solid #000; padding-bottom: 0.5rem; }
        h2 { font-size: 1.8rem; margin: 2rem 0 1rem; }
        h3 { font-size: 1.4rem; margin: 1.5rem 0 0.8rem; }
        hr { border: none; border-top: 2px solid #000; margin: 2rem 0; }

        .step { display: none; }
        .step.active { display: block; }

        .btn {
            background: #000;
            color: #fff;
            border: 2px solid #000;
            padding: 0.7rem 1.8rem;
            font-family: inherit;
            font-weight: bold;
            font-size: 1.1rem;
            cursor: pointer;
            margin: 1rem 0.5rem 1rem 0;
            transition: none;
        }
        .btn:hover { background: #fff; color: #000; }
        .btn:disabled, .btn.hotovo {
            background: #ccc;
            color: #666;
            border-color: #666;
            cursor: default;
        }
        .btn.hotovo:hover { background: #ccc; color: #666; }

        input, textarea {
            width: 100%;
            padding: 0.8rem;
            border: 2px solid #000;
            background: #fff;
            font-family: inherit;
            font-size: 1rem;
            margin: 0.3rem 0;
        }
        textarea { min-height: 80px; resize: vertical; }
        label { font-weight: bold; display: block; margin-top: 1rem; }

        /* VÃ½bÄ›r ikon */
        .ikony-volba {
            display: flex;
            gap: 0.8rem;
            margin: 0.5rem 0;
            flex-wrap: wrap;
        }
        .ikona-polozka {
            font-size: 2rem;
            cursor: pointer;
            padding: 0.2rem;
            border: 2px solid transparent;
        }
        .ikona-polozka.vybrana {
            border: 2px solid #000;
            background: #f0f0f0;
        }

        /* Seznam ÄlenÅ¯ */
        .clen-seznam { margin: 1.5rem 0; }
        .clen-polozka {
            display: flex;
            align-items: center;
            gap: 1rem;
            margin: 1rem 0;
            padding: 0.8rem;
            border: 2px solid #000;
            background: #f9f9f9;
            flex-wrap: wrap;
        }
        .clen-ikona {
            font-size: 2.5rem;
            line-height: 1;
            min-width: 50px;
            text-align: center;
        }
        .clen-jmeno { font-weight: bold; min-width: 120px; }
        .clen-odpoved { flex: 1; min-width: 250px; }
        .clen-tlacitko { min-width: 100px; }

        /* PohÃ¡dka - scroll okno */
        .pohadka-box {
            max-height: 300px;
            overflow-y: auto;
            border: 2px solid #000;
            padding: 1.5rem;
            margin: 1.5rem 0;
            background: #f5f5f5;
            white-space: pre-line;
            font-style: italic;
        }

        /* KolÃ¡ÄovÃ½ graf (zjednoduÅ¡enÃ½ jako seznam) */
        .graf-seznam {
            margin: 2rem 0;
            border: 2px solid #000;
            padding: 1.5rem;
        }
        .graf-polozka {
            display: flex;
            align-items: center;
            gap: 1rem;
            margin: 0.8rem 0;
        }
        .graf-barva {
            width: 30px;
            height: 30px;
            background: #000;
            border-radius: 50%;
        }
        .graf-barva.seda { background: #aaa; }
        .graf-nazev { font-weight: bold; width: 250px; }
        .graf-cislo { font-family: monospace; width: 80px; }
        .graf-procenta { width: 80px; }

        /* DoporuÄenÃ­ Q3 */
        .doporuceni {
            margin: 2rem 0;
            padding: 1.5rem;
            border: 2px solid #000;
            background: #f5f5f5;
        }
        .doporuceni-item {
            margin: 1.5rem 0;
            padding-left: 1rem;
            border-left: 6px solid #000;
        }

        .poznamka { font-size: 0.9rem; color: #333; margin: 1rem 0; }

        @media (max-width: 700px) {
            .clen-polozka { flex-direction: column; align-items: flex-start; }
        }
    </style>
</head>
<body>
<div class="container">
    <h1>ğŸ± KOCOUR â€“ diagnostickÃ½ mÃ³d</h1>
    <p><a href="../index.html" style="color:#000; text-decoration:underline;">â† zpÄ›t na rozcestnÃ­k karty</a> (uprav odkaz podle svÃ© struktury)</p>
    <hr>

    <!-- KROK 1: POÄŒET LIDÃ -->
    <div id="step1" class="step active">
        <h2>Krok 1: Kolik vÃ¡s je?</h2>
        <p>Zadejte poÄet ÄlenÅ¯ tÃ½mu, kteÅ™Ã­ se diagnostiky ÃºÄastnÃ­.</p>
        <input type="number" id="pocetLidi" min="1" max="20" value="3">
        <button class="btn" onclick="krok1Potvrdit()">Potvrdit</button>
    </div>

    <!-- KROK 2: JMÃ‰NA A IKONY -->
    <div id="step2" class="step">
        <h2>Krok 2: JmÃ©na a ikony</h2>
        <p>Ke kaÅ¾dÃ©mu doplÅˆte jmÃ©no a vyberte ikonu (kliknutÃ­m).</p>
        <div id="cleniKrok2"></div>
        <button class="btn" onclick="krok2Pokracovat()">PokraÄovat</button>
    </div>

    <!-- KROK 3: POHÃDKA + ODPOVÄšDI -->
    <div id="step3" class="step">
        <h2>Krok 3: PohÃ¡dka a vaÅ¡e postÅ™ehy</h2>

        <div class="pohadka-box" id="pohadkaText"></div>

        <p><strong>OtÃ¡zka:</strong> <em>â€Co vÃ¡m tenhle pÅ™Ã­bÄ›h pÅ™ipomÃ­nÃ¡ ve vaÅ¡Ã­ prÃ¡ci? Kde ve vaÅ¡em tÃ½mu vidÃ­te podobnÃ½ â€škocouÅ™Ã­â€˜ chovÃ¡nÃ­?â€œ</em></p>

        <div id="cleniKrok3"></div>

        <div id="vyhodnotitContainer" style="display:none;">
            <button class="btn" onclick="vyhodnotit()">Vyhodnotit â†’</button>
        </div>
    </div>

    <!-- KROK 4: VÃSLEDKY + GRAF -->
    <div id="step4" class="step">
        <h2>Krok 4: KognitivnÃ­ mapa tÃ½mu</h2>
        <p>Na zÃ¡kladÄ› vaÅ¡ich odpovÄ›dÃ­ jsme zjistili, jakÃ© Ãºhly ve vaÅ¡em tÃ½mu pÅ™evaÅ¾ujÃ­.</p>

        <div id="grafContainer" class="graf-seznam"></div>

        <div id="doporuceniContainer" class="doporuceni">
            <h3>ğŸ“Œ Rady (Q3) pro Ãºhly, kterÃ© se ve vaÅ¡em tÃ½mu objevily</h3>
        </div>

        <button class="btn" onclick="ulozVysledky()">ğŸ’¾ UloÅ¾it vÃ½sledky (s datem/Äasem)</button>
        <button class="btn" onclick="novaDiagnostika()">âŸ² NovÃ¡ diagnostika</button>
        <p class="poznamka">VÃ½sledky obsahujÃ­ jmÃ©na, odpovÄ›di, graf a rady Q3.</p>
    </div>

    <hr>
    <p style="text-align:center;">Â© KOCOUR â€“ diagnostickÃ½ mÃ³d (souÄÃ¡st systÃ©mu PLAMEÅ‡ÃK)</p>
</div>

<script>
// ----------------------------------------------------------------
// DATA â€“ POHÃDKA, 12 ÃšHLÅ® S Q2 (KLÃÄŒOVÃ SLOVA) a Q3 (RADY)
// ----------------------------------------------------------------
const POHADKA = `O kocourovi, kterÃ½ seÅ¾ral dvÄ› beruÅ¡ky a pÅ¯l hodiny krkal teÄky

SleÅ¾ral dvÄ› â€“ ne tÅ™i, ne jednu â€“ dvÄ› â€“ pÅ™esnÄ› â€“ 14 teÄek a trvalo to pÅ¯l hodiny â€“ 30 minut â€“ pÅ™esnÄ›. 
Jak to pÅ™iÅ¡lo, tak to pÅ™estalo. RÃ¡z na rÃ¡z.

ChÅˆap a hlt a chlamst â€“ nebo nÄ›co takovÃ©ho a nakonec â€“ mlask, mlask â€“ dvakrÃ¡t â€“ pÅ™esnÄ›.

Å½ily byly dvÄ› beruÅ¡ky, kaÅ¾dÃ¡ sedm teÄek mÄ›la, kdyÅ¾ uvidÄ›l je jeden kocour byla to mela. AspoÅˆ pro nÄ›.

Po 14ti teÄkÃ¡ch v jednom mÅ¾iku zem se slehla. RozhodnÄ› aspoÅˆ kocour se svÃ½mi Ãºtrobami.

Ale ta myÅ¡, vÅ¾dycky zvÄ›davÃ¡ byla. OdmaliÄka chodÃ­vala a kde mohla se vyptÃ¡vala, kde se teÄky na beruÅ¡kÃ¡ch vzaly? K Äemu je maji? ProÄ si radÅ¡i nevytvoÅ™Ã­ pravÃ½ maskovÃ¡nÃ­?

A ta pÅ™esnÃ¡ matika.. Kdo vlastnÄ› z tÄ›ch, co s nimi pÅ™ijdou do styku, takhle pÅ™esnÄ› poÄÃ­tÃ¡?

No a toho dne â€“ nÃ¡hle â€“ se to stalo a myÅ¡ svou odpovÄ›Ä mÄ›la. Kocour mlaskl a pak znovu a hned na to zaÄalo to.

PÅ¯l hodiny a bylo to zaznamenÃ¡no â€“ pÅ™esnÄ›. Kocour krkal teÄky a dokonÄoval vÄ›ty! NÄ›kdy celÃ© souvÄ›tÃ­!!

JenomÅ¾e tÃ­m zÃ¡roveÅˆ skÃ¡kal lidem do Å™eÄi, tÃ­m Å¾e za nÄ› dokonÄoval, co nedokonÄili. SkoÄil vÅ¡em do Å™eÄi koncem vÄ›ty â€“ ale vÅ¾dycky o nÄ›co mÃ¡lo, nÄ›kdy i o docela dost dÅ™Ã­v, neÅ¾ mÄ›la vÄ›ta pÅ¯vodnÄ› skonÄit.

A celou pÅ¯lhodinu nemohl tenkrÃ¡t nikdo nic â€“ ne â€“ dokonÄit. NeÅ¡lo to. KaÅ¾dÃ©mu dÅ™Ã­v, neÅ¾ se k tomu dostal, vÅ¡em kocour vÄ›tu ukonÄil. Hned.

Kocour se tomu smÃ¡l, ale krkal dÃ¡l. A krkal, dokud neskonÄil. PÅ™edstavte si to: SkonÄil vÄ›tu a pak skonÄil krkat.

A lidÃ© zase zaÄali moct svÃ© vÄ›ty ukonÄovat sami. Hned.

JenÅ¾e, jak se to tak obÄas stÃ¡vÃ¡, pÅ™estoÅ¾e nikdo nevÄ›dÄ›l co, kaÅ¾dÃ½ vÄ›dÄ›l, Å¾e nÄ›co nebylo stejnÃ©. A to, co jednou nenÃ­ stejnÃ© dnes, to nenÃ­ jednou stejnÃ© nikdy.

Jen nedokonÄenÃ© vÄ›ty bÃ½vajÃ­ vÅ¡echny stejnÃ©. Jednou, dnes i zÃ­tra. BeruÅ¡ky majÃ­ na sobÄ› nedokonÄenÃ© konce vÄ›t. VÄ›ci, kterÃ© jsou nespolknutÃ©.

Kocour to nevÄ›dÄ›l â€“ a dvÄ› spolknul. SpolknutÃ© konce ale vykrkal zpÃ¡tky a lide se nauÄili, Å¾e vÅ¡echno se spolknout nedÃ¡. A Å¾e teÄka je nÄ›kdy silnÄ›jÅ¡Ã­, neÅ¾ celÃ¡ vÄ›ta.

Kocour se naÅ¾ral a myÅ¡ i vÄ›ty zÅ¯stali celÃ©. DÃ­ky bohu za to. Å tÄ›stÃ­ dvou beruÅ¡ek se vrÃ¡tilo zpÃ¡tky.

Ale vÅ¡imly si toho jen kocour a malÃ¡ myÅ¡. A ani jeden neÅ™Ã­kali nic.

KONEC`;

// 12 ÃºhlÅ¯ â€“ nÃ¡zev, klÃ­ÄovÃ¡ slova (z Q2), rada (Q3)
const UHLY = [
    {
        nazev: "1. ğŸ”š FyzickÃ½ konec vÄ›ty",
        klicSlova: ["teÄka", "konec", "ukonÄit", "uzavÅ™Ã­t", "dokonÄit", "hotovo", "action point", "rychle", "takÅ¾e", "moÅ¾nÃ¡ bychom", "meeting", "pÅ™eruÅ¡en", "Å™eÅ¡enÃ­"],
        q3: "ZavÃ©st pravidlo 'tÅ™Ã­ teÄek' (...). KdyÅ¾ nÄ›kdo nÄ›co naznaÄÃ­, musÃ­ mÃ­t prostor to rozvÃ©st. PrvnÃ­, kdo Å™ekne 'teÄka', mÃ¡ za Ãºkol pouze shrnout, co slyÅ¡el, NE dodat svÅ¯j zÃ¡vÄ›r."
    },
    {
        nazev: "2. â±ï¸ Kvaziefektivita",
        klicSlova: ["rychle", "hotovo", "odkliknout", "agenda", "krÃ¡tkÃ©", "dÃ©lka", "rychlost", "efektivita", "akce", "vyÅ™Ã­dit", "stihnout", "Äas"],
        q3: "MÄ›Å™it ÃºspÄ›ch schÅ¯ze nikoli dÃ©lkou, ale poÄtem otevÅ™enÃ½ch otÃ¡zek na konci. Pokud jsou vÅ¡echny body 'uzavÅ™eny', pravdÄ›podobnÄ› jsme byli kocouÅ™i."
    },
    {
        nazev: "3. ğŸ NespolyknutelnÃ½ obsah",
        klicSlova: ["tÄ›Å¾kÃ© tÃ©ma", "elephant v mÃ­stnosti", "neÅ™Ã­kÃ¡ se", "potlaÄuje", "tabu", "vyhÃ½bat se", "dusÃ­", "atmosfÃ©ra", "citlivÃ©", "nepÅ™Ã­jemnÃ©"],
        q3: "VytvoÅ™it 'nÃ¡stÄ›nku nespolknutÃ©ho'. FyzickÃ©/virtuÃ¡lnÃ­ mÃ­sto, kde lze anonymnÄ› psÃ¡t 'nespolknutÃ© konce' z diskusÃ­. PravidelnÄ› je revidovat a zaÅ™azovat do agendy."
    },
    {
        nazev: "4. ğŸ­ PozorovatelskÃ¡ myÅ¡",
        klicSlova: ["tichÃ½", "introvert", "neslyÅ¡Ã­", "nemluvÃ­", "skrytÃ½", "pozorovatel", "neprosadÃ­ se", "stydlivÃ½", "nenÃ¡padnÃ½", "mlÄÃ­"],
        q3: "Jmenovat pro kaÅ¾dou dÅ¯leÅ¾itou diskusi 'myÅ¡'. JejÃ­ jedinou rolÃ­ je pozorovat, kdo mluvÃ­, kdo je pÅ™eruÅ¡ovÃ¡n, a na konci sdÄ›lit pozorovÃ¡nÃ­ bez hodnocenÃ­."
    },
    {
        nazev: "5. ğŸ•³ï¸ TrvalÃ¡ zmÄ›na",
        klicSlova: ["poÅ™Ã¡d stejnÃ½", "nic se nemÄ›nÃ­", "zase", "dokola", "trauma", "minulost", "jizva", "bojÃ­ se mluvit", "dÅ¯vÄ›ra", "naruÅ¡enÃ¡"],
        q3: "ÃšmyslnÄ› vytvÃ¡Å™et 'nedokonÄenÃ© vÄ›ty'. Leader musÃ­ zaÄÃ­t myÅ¡lenku a vyzvat ostatnÃ­, aby ji dokonÄili. Obnovovat dÅ¯vÄ›ru tÃ­m, Å¾e se vzdÃ¡ kontroly nad teÄkou."
    },
    {
        nazev: "6. ğŸ”¢ Tyranie metrik",
        klicSlova: ["ÄÃ­slo", "metrika", "splnÄ›no", "nesplnÄ›no", "kolik", "poÄet", "report", "mÄ›Å™it", "jen ÄÃ­sla", "bez kontextu", "kvantita"],
        q3: "PÅ™idat ke kaÅ¾dÃ© kvantitativnÃ­ metrice kvalitativnÃ­ pÅ™Ã­bÄ›h. Ne 'dokonÄili jsme 14 ÃºkolÅ¯', ale 'jakÃ½ch 14 teÄek jsme vykrkli a co to pro nÃ¡s znamenalo?'."
    },
    {
        nazev: "7. ğŸ¤ NÃ¡silnÃ½ konsenzus",
        klicSlova: ["souhlas", "ticho", "nikdo nic neÅ™ekl", "vÅ¡ichni souhlasÃ­", "rychlÃ© rozhodnutÃ­", "pÅ™ehlasovat", "nikdo neprotestoval"],
        q3: "PouÅ¾Ã­vat mechanismus 'souhlasu ticha'. Pokud po pÅ™edstavenÃ­ rozhodnutÃ­ je ticho, automaticky to znamenÃ¡ NESOUHLAS. NutÃ­ to lidi aktivnÄ› Å™Ã­kat 'souhlasÃ­m'."
    },
    {
        nazev: "8. ğŸ Konkurence mÃ­sto kolaborace",
        klicSlova: ["pÅ™eruÅ¡ovat", "skÃ¡kat do Å™eÄi", "kdo dÅ™Ã­v", "rychlejÅ¡Ã­", "dominovat", "pÅ™edvÃ©st se", "vyhrÃ¡t", "soutÄ›Å¾", "pÅ™ekÅ™ikovat"],
        q3: "ZavÃ©st 'kolo mluvÄÃ­ho' pro klÃ­ÄovÃ© diskuse. PouÅ¾Ã­vat fyzickÃ½ pÅ™edmÄ›t (talking stick). MluvÃ­ pouze ten, kdo ho drÅ¾Ã­. OstatnÃ­ jen aktivnÄ› naslouchajÃ­."
    },
    {
        nazev: "9. ğŸ NedokonÄenÃ© jako dar",
        klicSlova: ["Å™eÅ¡enÃ­ skÃ¡kat", "nedokonÄenÃ½", "otevÅ™enÃ½", "nechat plynout", "proces", "nejistota", "zvÄ›davost", "objevovat"],
        q3: "CviÄenÃ­ 'ÃºmyslnÄ› nedokonÄovat'. V brainstorming zadat: 'NÃ¡Å¡ problÃ©m je jako...'. A zakÃ¡zat dokonÄenÃ­ pÅ™irovnÃ¡nÃ­. Jen generovat zaÄÃ¡tky. Prozkoumat, kterÃ¡ nedokonÄenÃ¡ metafora je nejsilnÄ›jÅ¡Ã­."
    },
    {
        nazev: "10. ğŸ’” KomunikaÄnÃ­ trauma",
        klicSlova: ["schÅ¯ze", "stres", "bojÃ­ se", "trapas", "ztrapnit", "ponÃ­Å¾it", "ostuda", "Ãºzkost", "strach mluvit", "nepÅ™Ã­jemnÃ½ zÃ¡Å¾itek"],
        q3: "ProvÃ©st 'audit komunikaÄnÃ­ bezpeÄnosti'. AnonymnÃ­ dotaznÃ­k: CÃ­tÃ­m se bezpeÄnÄ› vyjÃ¡dÅ™it nesouhlas? Jsem Äasto pÅ™eruÅ¡ovÃ¡n? Berou moje nÃ¡pady vÃ¡Å¾nÄ›? Podle vÃ½sledkÅ¯ nastavit pravidla."
    },
    {
        nazev: "11. âš« SilnÃ¡ teÄka",
        klicSlova: ["rozhodnuto", "hotovo", "uzavÅ™eno", "teÄka", "konec diskuze", "bez diskuze", "autorita", "Å¡Ã©f Å™ekl", "bez pÅ™ipomÃ­nek"],
        q3: "PÅ™i uzavÃ­rÃ¡nÃ­ rozhodnutÃ­ neptat se 'Je to jasnÃ©?', ale 'Kdo cÃ­tÃ­, Å¾e jeho hlasy nebo obavy nebyly dostateÄnÄ› vyslyÅ¡eny pÅ™ed touto teÄkou?'."
    },
    {
        nazev: "12. ğŸ€ NavrÃ¡cenÃ© Å¡tÄ›stÃ­",
        klicSlova: ["uzdravenÃ­", "zmÄ›na k lepÅ¡Ã­mu", "pomalu", "zlepÅ¡uje se", "dÅ¯vÄ›ra", "otevÅ™enost", "kÅ™ehkÃ©", "opatrnÄ›", "novÃ½ zaÄÃ¡tek"],
        q3: "Nastavit 'beruÅ¡ÄÃ­ rituÃ¡l'. Kdykoli nÄ›kdo pocÃ­tÃ­, Å¾e byl 'seÅ¾rÃ¡n' (pÅ™eruÅ¡ovÃ¡n, umlÄovÃ¡n), mÅ¯Å¾e tichÃ½m symbolem (napÅ™. poloÅ¾it beruÅ¡ku na stÅ¯l) signalizovat potÅ™ebu zpomalit a vyslechnout."
    }
];

// Sada ikon (Å¾Ã¡dnÃ¡ zvÃ­Å™Ã¡tka)
const IKONY = ['ğŸŒ‹', 'â™Ÿï¸', 'ğŸ”Œ', 'ğŸ©', 'ğŸ›¹', 'ğŸ’£' , 'ğŸ•¸ï¸' , 'âš½' , 'â›¸ï¸' , 'ğŸŒªï¸', 'ğŸ‘»', 'ğŸ¤º', 'ğŸª½', 'ğŸ¥‹'];

// Stav aplikace
let pocet = 3;
let clenove = []; // { jmeno, ikona, odpoved, hotovo, uhelIndex }

// ----------------------------------------------------------------
// KROK 1
function krok1Potvrdit() {
    pocet = parseInt(document.getElementById('pocetLidi').value);
    if (isNaN(pocet) || pocet < 1) { alert('Zadejte platnÃ½ poÄet (alespoÅˆ 1).'); return; }
    if (pocet > 20) { alert('MaximÃ¡lnÄ› 20 lidÃ­.'); return; }

    clenove = [];
    for (let i = 0; i < pocet; i++) {
        clenove.push({
            jmeno: '',
            ikona: IKONY[i % IKONY.length],
            odpoved: '',
            hotovo: false,
            uhelIndex: -1
        });
    }
    zobrazKrok2();
}

// ----------------------------------------------------------------
// KROK 2
function zobrazKrok2() {
    document.querySelectorAll('.step').forEach(s => s.classList.remove('active'));
    document.getElementById('step2').classList.add('active');

    let html = '';
    for (let i = 0; i < pocet; i++) {
        html += `
            <div class="clen-polozka" id="clen2-${i}">
                <div class="clen-ikona" id="ikona-${i}">${clenove[i].ikona}</div>
                <div style="flex:1;">
                    <input type="text" id="jmeno-${i}" placeholder="JmÃ©no Älena" value="${clenove[i].jmeno}">
                    <div class="ikony-volba" id="ikony-${i}">
                        ${IKONY.map(ik => `<span class="ikona-polozka ${ik === clenove[i].ikona ? 'vybrana' : ''}" onclick="vybratIkonu(${i}, '${ik}')">${ik}</span>`).join('')}
                    </div>
                </div>
            </div>
        `;
    }
    document.getElementById('cleniKrok2').innerHTML = html;
}

function vybratIkonu(index, ikona) {
    clenove[index].ikona = ikona;
    document.getElementById(`ikona-${index}`).innerText = ikona;
    // Odebrat tÅ™Ã­du 'vybrana' ze vÅ¡ech v tom Å™Ã¡dku
    let container = document.getElementById(`ikony-${index}`);
    Array.from(container.children).forEach(el => el.classList.remove('vybrana'));
    // NajÃ­t kliknutÃ½ prvek a pÅ™idat mu tÅ™Ã­du
    Array.from(container.children).forEach(el => {
        if (el.innerText === ikona) el.classList.add('vybrana');
    });
}

function krok2Pokracovat() {
    for (let i = 0; i < pocet; i++) {
        let input = document.getElementById(`jmeno-${i}`);
        clenove[i].jmeno = input.value.trim() || `ÄŒlen ${i+1}`;
    }
    zobrazKrok3();
}

// ----------------------------------------------------------------
// KROK 3
function zobrazKrok3() {
    document.querySelectorAll('.step').forEach(s => s.classList.remove('active'));
    document.getElementById('step3').classList.add('active');

    document.getElementById('pohadkaText').innerText = POHADKA;

    let html = '';
    for (let i = 0; i < pocet; i++) {
        let disabledAttr = clenove[i].hotovo ? 'disabled' : '';
        html += `
            <div class="clen-polozka" id="clen3-${i}">
                <div class="clen-ikona">${clenove[i].ikona}</div>
                <div class="clen-jmeno">${clenove[i].jmeno}</div>
                <div class="clen-odpoved">
                    <textarea id="odpoved-${i}" placeholder="VaÅ¡e odpovÄ›Ä..." ${disabledAttr}>${clenove[i].odpoved}</textarea>
                </div>
                <div class="clen-tlacitko">
                    <button class="btn ${clenove[i].hotovo ? 'hotovo' : ''}" id="btn-${i}" onclick="potvrditOdpoved(${i})" ${disabledAttr}>${clenove[i].hotovo ? 'Hotovo' : 'Hotovo?'}</button>
                </div>
            </div>
        `;
    }
    document.getElementById('cleniKrok3').innerHTML = html;
    document.getElementById('vyhodnotitContainer').style.display = clenove.every(c => c.hotovo) ? 'block' : 'none';
}

function potvrditOdpoved(index) {
    let ta = document.getElementById(`odpoved-${index}`);
    clenove[index].odpoved = ta.value;
    clenove[index].hotovo = true;

    let btn = document.getElementById(`btn-${index}`);
    btn.disabled = true;
    btn.classList.add('hotovo');
    btn.innerText = 'Hotovo';

    if (clenove.every(c => c.hotovo)) {
        document.getElementById('vyhodnotitContainer').style.display = 'block';
    }
}

// ----------------------------------------------------------------
// VYHODNOCENÃ (KROK 4)
function vyhodnotit() {
    // SesbÃ­rat odpovÄ›di (kdyby nÄ›kdo nÄ›co mÄ›nil)
    for (let i = 0; i < pocet; i++) {
        let ta = document.getElementById(`odpoved-${i}`);
        if (ta) clenove[i].odpoved = ta.value;
    }

    // Pro kaÅ¾dÃ©ho Älena najÃ­t nejlepÅ¡Ã­ Ãºhel podle klÃ­ÄovÃ½ch slov
    clenove.forEach(clen => {
        let text = clen.odpoved.toLowerCase();
        let skore = UHLY.map(u => {
            let count = 0;
            u.klicSlova.forEach(slovo => {
                if (text.includes(slovo.toLowerCase())) count++;
            });
            return count;
        });
        // NajÃ­t index s nejvyÅ¡Å¡Ã­m skÃ³re
        let maxSkore = Math.max(...skore);
        if (maxSkore > 0) {
            clen.uhelIndex = skore.indexOf(maxSkore);
        } else {
            clen.uhelIndex = -1; // nezaÅ™azeno
        }
    });

    // SpoÄÃ­tat Äetnosti ÃºhlÅ¯ v tÃ½mu (pouze ty s indexem >=0)
    let cetnosti = new Array(UHLY.length).fill(0);
    clenove.forEach(clen => {
        if (clen.uhelIndex >= 0) cetnosti[clen.uhelIndex]++;
    });

    // VytvoÅ™it seznam ÃºhlÅ¯, kterÃ© se v tÃ½mu objevily (cetnost > 0)
    let pouziteUhly = [];
    for (let i = 0; i < UHLY.length; i++) {
        if (cetnosti[i] > 0) pouziteUhly.push({ index: i, nazev: UHLY[i].nazev, cetnost: cetnosti[i], q3: UHLY[i].q3 });
    }

    // Vykreslit graf (jen pouzite uhly)
    let grafHtml = '';
    pouziteUhly.forEach(u => {
        let procenta = ((u.cetnost / pocet) * 100).toFixed(1);
        grafHtml += `
            <div class="graf-polozka">
                <div class="graf-barva"></div>
                <div class="graf-nazev">${u.nazev}</div>
                <div class="graf-cislo">${u.cetnost} lidÃ­</div>
                <div class="graf-procenta">${procenta} %</div>
            </div>
        `;
    });
    if (pouziteUhly.length === 0) grafHtml = '<p>Å½Ã¡dnÃ½ Ãºhel nebyl jednoznaÄnÄ› identifikovÃ¡n. Zkuste odpovÄ›dÄ›t konkrÃ©tnÄ›ji.</p>';
    document.getElementById('grafContainer').innerHTML = grafHtml;

    // Vykreslit doporuÄenÃ­ (Q3 pro pouzite uhly)
    let dopHtml = '<h3>ğŸ“Œ Rady (Q3) pro Ãºhly, kterÃ© se ve vaÅ¡em tÃ½mu objevily</h3>';
    pouziteUhly.forEach(u => {
        dopHtml += `
            <div class="doporuceni-item">
                <strong>${u.nazev}</strong><br>
                ${u.q3}
            </div>
        `;
    });
    if (pouziteUhly.length === 0) dopHtml += '<p>Zkuste to znovu s konkrÃ©tnÄ›jÅ¡Ã­mi odpovÄ›Ämi.</p>';
    document.getElementById('doporuceniContainer').innerHTML = dopHtml;

    // Zobrazit krok 4
    document.querySelectorAll('.step').forEach(s => s.classList.remove('active'));
    document.getElementById('step4').classList.add('active');
}

// ----------------------------------------------------------------
// ULOÅ½ENÃ VÃSLEDKÅ®
function ulozVysledky() {
    let d = new Date();
    let datumCas = `${d.toLocaleDateString()} ${d.toLocaleTimeString()}`;

    let text = `VÃSLEDKY DIAGNOSTIKY â€“ KOCOUR\n`;
    text += `Datum a Äas: ${datumCas}\n`;
    text += `PoÄet ÄlenÅ¯: ${pocet}\n`;
    text += `ÄŒlenovÃ©:\n`;
    clenove.forEach(c => text += `- ${c.ikona} ${c.jmeno}\n`);

    text += `\nODPOVÄšDI NA OTÃZKU (Q2):\n`;
    clenove.forEach(c => text += `${c.jmeno}: ${c.odpoved}\n`);

    // Znovu spoÄÃ­tat Äetnosti (pro jistotu)
    let cetnosti = new Array(UHLY.length).fill(0);
    clenove.forEach(clen => {
        if (clen.uhelIndex >= 0) cetnosti[clen.uhelIndex]++;
    });
    let pouziteUhly = [];
    for (let i = 0; i < UHLY.length; i++) {
        if (cetnosti[i] > 0) pouziteUhly.push({ nazev: UHLY[i].nazev, cetnost: cetnosti[i], q3: UHLY[i].q3 });
    }

    text += `\nVÃSLEDKY TÃMU (pouÅ¾itÃ© Ãºhly):\n`;
    pouziteUhly.forEach(u => {
        let procenta = ((u.cetnost / pocet) * 100).toFixed(1);
        text += `- ${u.nazev}: ${u.cetnost} lidÃ­ (${procenta} %)\n`;
    });

    text += `\nDOPORUÄŒENÃ Q3 PRO POUÅ½ITÃ‰ ÃšHLY:\n`;
    pouziteUhly.forEach(u => {
        text += `\n${u.nazev}\n${u.q3}\n`;
    });

    const blob = new Blob([text], { type: 'text/plain;charset=utf-8' });
    const a = document.createElement('a');
    a.href = URL.createObjectURL(blob);
    a.download = `kocour_diagnostika_${d.toISOString().slice(0,19).replace(/:/g, '-')}.txt`;
    a.click();
}

// ----------------------------------------------------------------
// NOVÃ DIAGNOSTIKA
function novaDiagnostika() {
    pocet = 3;
    clenove = [];
    document.getElementById('pocetLidi').value = 3;
    document.querySelectorAll('.step').forEach(s => s.classList.remove('active'));
    document.getElementById('step1').classList.add('active');
}
</script>
</body>
</html>
