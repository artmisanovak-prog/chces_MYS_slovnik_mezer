<!DOCTYPE html>
<html lang="cs">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>üêà‚Äç‚¨õ Kocour ‚Äì diagnostick√Ω m√≥d</title>
<style>
  * { box-sizing: border-box; margin: 0; padding: 0; }
  body {
    font-family: Georgia, serif;
    background: #fff;
    color: #111;
    max-width: 700px;
    margin: 0 auto;
    padding: 1.5rem 1rem;
    line-height: 1.6;
  }
  h1 { font-size: 1.4rem; margin-bottom: 0.3rem; }
  h2 { font-size: 1.1rem; margin: 1.5rem 0 0.5rem; border-bottom: 1px solid #111; padding-bottom: 0.3rem; }
  .nav { font-size: 0.85rem; margin-bottom: 1.5rem; }
  .nav a { color: #111; }
  details { border: 1px solid #111; margin-bottom: 1.2rem; }
  details summary {
    cursor: pointer;
    padding: 0.7rem 1rem;
    font-weight: bold;
    list-style: none;
    user-select: none;
  }
  details summary::before { content: "‚ñ∂ "; }
  details[open] summary::before { content: "‚ñº "; }
  .pohadka-summary { background: #111; color: #fff; }
  .pohadka-obsah {
    padding: 1rem;
    font-size: 0.9rem;
    white-space: pre-line;
    border-top: 1px solid #111;
  }
  .pohadka-img {
    width: 100%; max-height: 180px; object-fit: contain;
    display: block; filter: grayscale(100%); padding: 0.5rem;
  }
  .navod-obsah, .klic-obsah { padding: 0.7rem 1rem 1rem; font-size: 0.88rem; }
  .navod-obsah p, .klic-obsah p { margin-bottom: 0.5rem; }
  .navod-obsah ul { margin-left: 1.2rem; }
  .navod-obsah li { margin-bottom: 0.3rem; }
  .klic-uhel { border-bottom: 1px solid #eee; padding: 0.5rem 0; }
  .klic-uhel:last-child { border-bottom: none; }
  .klic-uhel strong { display: block; }
  .klic-uhel em { color: #555; font-size: 0.82rem; }
  .otazky {
    background: #f5f5f5; border-left: 3px solid #111;
    padding: 0.8rem 1rem; margin-bottom: 1.5rem; font-size: 0.9rem;
  }
  .otazky p { margin-bottom: 0.4rem; }
  .setup { display: flex; align-items: center; gap: 1rem; margin-bottom: 0.8rem; flex-wrap: wrap; }
  .setup label { font-size: 0.9rem; }
  .setup input[type=number] {
    width: 60px; padding: 0.4rem; border: 1px solid #111;
    font-size: 1rem; text-align: center;
  }
  .btn {
    padding: 0.5rem 1.2rem; background: #111; color: #fff;
    border: none; cursor: pointer; font-size: 0.9rem; font-family: Georgia, serif;
  }
  .btn:hover { background: #333; }
  .btn-outline { background: #fff; color: #111; border: 1px solid #111; }
  .btn-danger {
    background: #fff; color: #aaa; border: 1px solid #ddd;
    font-size: 0.82rem; padding: 0.3rem 0.8rem;
    cursor: pointer; font-family: Georgia, serif;
  }
  .btn-danger:hover { border-color: #111; color: #111; }
  .autosave-row {
    display: none; align-items: center; gap: 1rem;
    flex-wrap: wrap; margin-bottom: 1.2rem;
  }
  .autosave-info { font-size: 0.78rem; color: #888; font-style: italic; flex: 1; }
  .clen-details { border: 1px solid #111; margin-bottom: 1rem; }
  .clen-summary {
    cursor: pointer; padding: 0.7rem 1rem; font-size: 0.9rem;
    list-style: none; display: flex; align-items: center; gap: 0.5rem;
    user-select: none; background: #fafafa;
  }
  .clen-summary::before { content: "‚ñ∂ "; font-size: 0.75rem; color: #555; }
  .clen-details[open] .clen-summary::before { content: "‚ñº "; }
  .clen-summary-jmeno { font-weight: bold; flex: 1; }
  .clen-summary-stav { font-size: 0.75rem; color: #888; font-style: italic; }
  .stav-hotovo { color: #2a7a2a !important; font-weight: bold; }
  .clen-telo { padding: 1rem; border-top: 1px solid #eee; }
  .clen-hlavicka { display: flex; align-items: center; gap: 0.7rem; margin-bottom: 0.8rem; }
  .clen-jmeno {
    flex: 1; padding: 0.3rem 0.5rem; border: 1px solid #aaa;
    font-family: Georgia, serif; font-size: 0.9rem;
  }
  .otazka-radek { margin-bottom: 0.9rem; }
  .otazka-radek label {
    display: block; font-size: 0.8rem; font-weight: bold;
    margin-bottom: 0.3rem; color: #444;
  }
  .otazka-radek textarea {
    width: 100%; padding: 0.4rem 0.5rem; border: 1px solid #ccc;
    font-family: Georgia, serif; font-size: 0.85rem;
    resize: vertical; min-height: 50px;
  }
  .otazka-radek select {
    width: 100%; padding: 0.4rem 0.5rem; border: 1px solid #111;
    font-family: Georgia, serif; font-size: 0.85rem;
    background: #fff; margin-top: 0.2rem;
  }
  .select-napoveda {
    display: block; font-size: 0.74rem; color: #999;
    font-style: italic; margin-top: 0.2rem;
  }
  .vysledky { margin-top: 2rem; border-top: 2px solid #111; padding-top: 1rem; }
  .mapa-tabulka { width: 100%; border-collapse: collapse; font-size: 0.85rem; margin-bottom: 1.2rem; }
  .mapa-tabulka th, .mapa-tabulka td { border: 1px solid #ccc; padding: 0.4rem 0.6rem; text-align: left; }
  .mapa-tabulka th { background: #111; color: #fff; }
  .pretizeny { background: #f0f0f0; font-weight: bold; }
  .deficitni { color: #777; }
  .sekce-vysledku { margin-bottom: 1.5rem; }
  .sekce-vysledku h3 { font-size: 0.95rem; border-bottom: 1px solid #ccc; padding-bottom: 0.3rem; margin-bottom: 0.7rem; }
  .uhel-vysledek { margin-bottom: 0.8rem; font-size: 0.88rem; }
  .uhel-vysledek strong { display: block; }
  .uhel-doporuceni {
    border-left: 2px solid #111; padding-left: 0.7rem;
    margin-top: 0.3rem; color: #333; font-style: italic;
  }
  .generativni-odkaz {
    margin-top: 1.5rem; font-size: 0.85rem;
    border-top: 1px solid #ccc; padding-top: 1rem;
  }
  .generativni-odkaz a { color: #111; }
  @media print {
    .btn, .setup, .autosave-row, .nav, .select-napoveda { display: none !important; }
    details[open] summary { display: none; }
  }
</style>
</head>
<body>

<!-- FIX 1: spr√°vn√° navigace -->
<div class="nav">
  <a href="../">‚Üê Kocour</a> &nbsp;|&nbsp;
  <a href="../../../">Chce≈° my≈°?</a>
</div>

<h1>üêà‚Äç‚¨õ Kocour ‚Äì diagnostick√Ω m√≥d</h1>
<p style="font-size:0.85rem; color:#555; margin-bottom:1rem;">Tyranie p≈ôedƒçasn√©ho uzav√≠r√°n√≠ v komunikaci</p>

<details>
  <summary>üêÅ N√°vod pro facilit√°tora (my≈°)</summary>
  <div class="navod-obsah">
    <p><strong>Ty jsi my≈°.</strong> Sed√≠≈°, poslouch√°≈°, zapisuje≈°. Nehodnot√≠≈°, kdo m√° pravdu ‚Äî mapuje≈°, jak t√Ωm mysl√≠.</p>
    <p><strong>D≈Øle≈æit√© p≈ôed zaƒç√°tkem:</strong></p>
    <ul>
      <li>Kocour nen√≠ ƒçlovƒõk. Je to porucha ‚Äî zp≈Øsob, jak√Ωm se t√Ωm chov√° v urƒçit√©m momentu.</li>
      <li>Zv√≠≈ô√°tka jsou poruchy. D√≠vka na kartƒõ je ≈ôeƒç. Zv√≠≈ôe je porucha. Text mezi nimi je mezera pro interpretaci.</li>
      <li>√öhly nejsou osobnostn√≠ typy. Stejn√Ω ƒçlovƒõk se v jin√Ω den d√≠v√° jin√Ωm √∫hlem. Nejde o ≈°katulkov√°n√≠ lid√≠.</li>
      <li>Neexistuje spr√°vn√Ω nebo ≈°patn√Ω √∫hel. Jde o to m√≠t jich co nejv√≠c ‚Äî roz≈°i≈ôovat pohled.</li>
      <li>P≈ôi≈ôazuje≈° ty ‚Äî podle toho, co sly≈°√≠≈°. √öhel vyb√≠r√°≈° intuitivnƒõ, podle j√°dra odpovƒõdi.</li>
      <li>Z√°pisn√≠k se ukl√°d√° pr≈Øbƒõ≈ænƒõ ‚Äî p≈ôe≈æije zav≈ôen√≠ prohl√≠≈æeƒçe i refresh str√°nky.</li>
    </ul>
    <p>Kl√≠ƒç k √∫hl≈Øm m√°≈° v≈ædy k dispozici ‚Äî rozbal ho n√≠≈æe kdykoli pot≈ôebuje≈°.</p>
  </div>
</details>

<!-- FIX 3: poh√°dka bez max-height, ƒçte se cel√° -->
<details>
  <summary class="pohadka-summary">üìñ Poh√°dka o kocourovi</summary>
  <img src="kocour.jpg" alt="Kocour" class="pohadka-img" onerror="this.style.display='none'">
  <div class="pohadka-obsah" id="pohadka-text"></div>
</details>

<details>
  <summary>üîë Kl√≠ƒç k √∫hl≈Øm (pro p≈ôi≈ôazov√°n√≠)</summary>
  <div class="klic-obsah" id="klic-uhlu-text"></div>
</details>

<div class="otazky">
  <strong>T≈ôi ot√°zky pro t√Ωm (Kocour):</strong>
  <p><strong>Q1 ‚Äì Smysl:</strong> Co je podle v√°s hlavn√≠ pointa nebo sdƒõlen√≠ tohoto p≈ô√≠bƒõhu?</p>
  <p><strong>Q2 ‚Äì Zaujet√≠:</strong> Kter√° konkr√©tn√≠ vƒõta, obraz nebo moment v√°s nejv√≠c zaujal/a a proƒç?</p>
  <p><strong>Q3 ‚Äì Aplikace:</strong> Kdyby tento p≈ô√≠bƒõh byl n√°vodem nebo radou, co by v√°m radil dƒõlat (nebo nedƒõlat) ve va≈°em pracovn√≠m ≈æivotƒõ?</p>
</div>

<div class="setup">
  <label>Poƒçet ƒçlen≈Ø t√Ωmu:</label>
  <input type="number" id="pocet-clenu" min="1" max="30" value="4">
  <button class="btn" onclick="vytvorKarty()">Vytvo≈ôit z√°pisn√≠k</button>
</div>

<!-- FIX 5: autosave info + maz√°n√≠ -->
<div class="autosave-row" id="autosave-row">
  <span class="autosave-info">üíæ Z√°pisn√≠k se pr≈Øbƒõ≈ænƒõ ukl√°d√° ‚Äî p≈ôe≈æije i zav≈ôen√≠ prohl√≠≈æeƒçe.</span>
  <button class="btn-danger" onclick="smazatZapisnik()">üóë Vymazat z√°pisn√≠k</button>
</div>

<div id="karty-clenu"></div>

<div id="tlacitko-vyhodnotit" style="display:none; margin-top:1rem;">
  <button class="btn" onclick="vyhodnotit()">üê≠ Vyhodnotit ‚Äì uk√°zat kognitivn√≠ mapu t√Ωmu</button>
</div>

<div id="vysledky" class="vysledky" style="display:none;"></div>

<p class="generativni-odkaz">üîÆ Chce≈° na z√°kladƒõ kognitivn√≠ mapy vygenerovat nov√Ω workshop? Zkus <a href="generativni.html">generativn√≠ m√≥d</a>.</p>

<script>
const POHADKA_TEXT = `O KOCOUROVI
Jak kocour se≈æral dvƒõ beru≈°ky a p≈Øl hodiny krkal teƒçky
_________________

Sle≈æral dvƒõ - ne t≈ôi, ne jednu - dvƒõ - p≈ôesnƒõ - 14 teƒçek a trvalo to p≈Øl hodiny - 30 minut - p≈ôesnƒõ.

Jak to p≈ôi≈°lo tak to p≈ôestalo.
R√°z na r√°z.

Ch≈àap a hlt a chlamst - nebo nƒõco takov√©ho a nakonec - mlask, mlask - dvakr√°t - p≈ôesnƒõ.

≈Ωily byly dvƒõ beru≈°ky, ka≈æd√° sedm teƒçek mƒõla, kdy≈æ uvidƒõl je jeden kocour byla to mela.
Aspo≈à pro nƒõ.

Po 14ti teƒçk√°ch
v jednom m≈æiku
zem se slehla.

Rozhodnƒõ aspo≈à kocour se sv√Ωmi √∫trobami.

Ale ta my≈°, v≈ædycky zvƒõdav√° byla.
Odmaliƒçka chod√≠vala
a kde mohla se vypt√°vala,
kde se teƒçky na beru≈°k√°ch vzaly?
K ƒçemu je maj√≠?
Proƒç si rad≈°i nevytvo≈ô√≠ prav√Ω maskov√°n√≠?

A ta p≈ôesn√° matika..
Kdo vlastnƒõ z tƒõch, co s nimi p≈ôijdou do styku, takhle p≈ôesnƒõ poƒç√≠t√°?

No a toho dne - n√°hle - se to stalo
a my≈° svou odpovƒõƒè mƒõla.

Kocour mlaskl
a pak znovu
a hned na to
zaƒçalo to.

P≈Øl hodiny a bylo to zaznamen√°no - p≈ôesnƒõ.
Kocour krkal teƒçky a dokonƒçoval vƒõty!
Nƒõkdy cel√© souvƒõt√≠!!

Jenom≈æe t√≠m z√°rove≈à sk√°kal lidem do ≈ôeƒçi,
t√≠m ≈æe za nƒõ dokonƒçoval, co nedokonƒçili.

Skoƒçil v≈°em do ≈ôeƒçi koncem vƒõty

ale v≈ædycky o nƒõco m√°lo

nƒõkdy i o docela dost

d≈ô√≠v, ne≈æ mƒõla vƒõta p≈Øvodnƒõ skonƒçit

nebo - ne≈æ p≈Øvodnƒõ vƒõta skonƒçit mƒõla.

A celou p≈Ølhodinu nemohl tenkr√°t nikdo nic
ne - dokonƒçit.
Ne≈°lo to.

Ka≈æd√©mu d≈ô√≠v,
ne≈æ se k tomu dostal,
v≈°em kocour vƒõtu ukonƒçil.
Hned.

Kocour se tomu sm√°l,
ale krkal d√°l.
A krkal, dokud neskonƒçil.
P≈ôedstavte si to:
Skonƒçil vƒõtu a pak skonƒçil krkat.

A lid√© zase zaƒçali moct sv√© vƒõty ukonƒçovat sami.
Hned.

Jen≈æe, jak se to tak obƒças st√°v√°,
p≈ôesto≈æe nikdo nevƒõdƒõl co,
ka≈æd√Ω vƒõdƒõl,
≈æe nƒõco nebylo stejn√©.

A to, co jednou nen√≠ stejn√© dnes,
to nen√≠ jednou stejn√© nikdy.

Jen nedokonƒçen√© vƒõty b√Ωvaj√≠ v≈°echny stejn√©. Jednou, dnes i z√≠tra.

Beru≈°ky maj√≠ na sobƒõ nedokonƒçen√© konce vƒõt. Vƒõci, kter√© jsou nespolknut√©.

Kocour to nevƒõdƒõl - a dvƒõ spolknul.
Spolknut√© konce ale vykrkal zp√°tky
a lid√© se nauƒçili,
≈æe v≈°echno se spolknout ned√°.
A ≈æe teƒçka je nƒõkdy silnƒõj≈°√≠, ne≈æ cel√° vƒõta.

Kocour se na≈æral a my≈° i vƒõty z≈Østaly cel√©.
D√≠ky bohu za to.
≈†tƒõst√≠ dvou beru≈°ek se vr√°tilo zp√°tky.

Ale v≈°imly si toho jen kocour a mal√° my≈°.
A ani jeden ne≈ô√≠kali nic.

KONEC`;

const KLIC_UHLY = [
  { id:1,  nazev:"Absurdn√≠",       popis:"Hled√° rozpor a paradox. Svƒõt p≈ôestal d√°vat smysl ‚Äî a to mu vyhovuje." },
  { id:2,  nazev:"Jazykov√Ω",       popis:"Sly≈°√≠ slova, rytmus, zvuk. Forma je pro nƒõj obsah." },
  { id:3,  nazev:"Ironick√Ω",       popis:"Vid√≠ propast mezi z√°mƒõrem a v√Ωsledkem. Lehk√Ω sarkasmus, ho≈ôk√Ω √∫smƒõv." },
  { id:4,  nazev:"Filozofick√Ω",    popis:"Hled√° smysl za smyslem. Odpov√≠d√° na ot√°zku za ot√°zkou." },
  { id:5,  nazev:"Surrealistick√Ω", popis:"Spojuje nespojiteln√©. Mysl√≠ v obrazech, ne v argumentech." },
  { id:6,  nazev:"Naivn√≠",         popis:"Pt√° se jednodu≈°e, odpov√≠d√° p≈ô√≠mo. ƒåist√Ω dojem bez racionalizace." },
  { id:7,  nazev:"Introspektivn√≠", popis:"P≈ô√≠bƒõh je mu z√°minkou k sebepozn√°n√≠. Mluv√≠ o sobƒõ skrze poh√°dku." },
  { id:8,  nazev:"Konkr√©tn√≠",      popis:"Dr≈æ√≠ se fakt≈Ø. Dƒõj je dƒõj. Nepot≈ôebuje skryt√© v√Ωznamy." },
  { id:9,  nazev:"Analogick√Ω",     popis:"Hled√° vzorce. P≈ôirovn√°v√° k nƒõƒçemu, co u≈æ zn√°." },
  { id:10, nazev:"Asociaƒçn√≠",      popis:"Mysl√≠ s√≠≈•ovƒõ. Jedno slovo spou≈°t√≠ deset dal≈°√≠ch." },
  { id:11, nazev:"Metaforick√Ω",    popis:"V≈°e je symbolem nƒõƒçeho vƒõt≈°√≠ho. Dek√≥duje skryt√© v√Ωznamy." },
  { id:12, nazev:"Groteskn√≠",      popis:"Vid√≠ p≈ôehnan√© a temnƒõ komick√©. Sm√≠ch, kter√Ω ≈°kr√°be." }
];

const uhly = [
  { id:1,  emoji:"üîö", nazev:"Fyzick√Ω konec vƒõty",
    q3:"Zav√©st pravidlo 't≈ô√≠ teƒçek'. Kdy≈æ nƒõkdo nƒõco naznaƒç√≠, mus√≠ m√≠t prostor to rozv√©st. Prvn√≠, kdo ≈ôekne 'teƒçka', jen shrne ‚Äî NE dod√° sv≈Øj z√°vƒõr." },
  { id:2,  emoji:"‚è±Ô∏è", nazev:"Kvaziefektivita",
    q3:"Mƒõ≈ôit √∫spƒõch sch≈Øze nikoli d√©lkou, ale poƒçtem otev≈ôen√Ωch ot√°zek na konci. Pokud jsou v≈°echny body 'uzav≈ôeny', pravdƒõpodobnƒõ jsme byli kocou≈ôi." },
  { id:3,  emoji:"üêû", nazev:"Nespolyknuteln√Ω obsah",
    q3:"Vytvo≈ôit 'n√°stƒõnku nespolknut√©ho'. Anonymn√≠ m√≠sto pro vƒõci, kter√© se ne≈ôekly. Pravidelnƒõ je za≈ôazovat do agendy." },
  { id:4,  emoji:"üêÄ", nazev:"Pozorovatelsk√° my≈°",
    q3:"Jmenovat pro ka≈ædou diskusi 'my≈°'. Jen pozoruje, kdo mluv√≠, kdo je p≈ôeru≈°ov√°n, a na konci sdƒõl√≠ pozorov√°n√≠ bez hodnocen√≠." },
  { id:5,  emoji:"üï≥Ô∏è", nazev:"Trval√° zmƒõna",
    q3:"√ömyslnƒõ vytv√°≈ôet 'nedokonƒçen√© vƒõty'. Leader zaƒçne my≈°lenku a vyzve ostatn√≠, aby ji dokonƒçili." },
  { id:6,  emoji:"üî¢", nazev:"Tyranie metrik",
    q3:"Ke ka≈æd√© metrice p≈ôidat kvalitativn√≠ p≈ô√≠bƒõh. Ne '14 √∫kol≈Ø hotovo', ale 'co pro n√°s tƒõch 14 teƒçek znamenalo?'." },
  { id:7,  emoji:"ü¶æ", nazev:"N√°siln√Ω konsenzus",
    q3:"Mechanismus 'souhlasu ticha': ticho po rozhodnut√≠ automaticky znamen√° NESOUHLAS. Nut√≠ lidi aktivnƒõ ≈ô√≠kat 'souhlas√≠m'." },
  { id:8,  emoji:"üèÅ", nazev:"Konkurence m√≠sto kolaborace",
    q3:"Zav√©st 'kolo mluvƒç√≠ho'. Fyzick√Ω p≈ôedmƒõt (talking stick) ‚Äî mluv√≠ jen ten, kdo ho dr≈æ√≠." },
  { id:9,  emoji:"üéÅ", nazev:"Nedokonƒçen√© jako dar",
    q3:"Cviƒçen√≠ '√∫myslnƒõ nedokonƒçovat': 'N√°≈° probl√©m je jako‚Ä¶' ‚Äî zak√°zat dokonƒçen√≠. Jen generovat zaƒç√°tky." },
  { id:10, emoji:"üíî", nazev:"Komunikaƒçn√≠ trauma",
    q3:"'Audit komunikaƒçn√≠ bezpeƒçnosti': C√≠t√≠m se bezpeƒçnƒõ vyj√°d≈ôit nesouhlas? Jsem p≈ôeru≈°ov√°n? V√Ωsledky ‚Üí pravidla." },
  { id:11, emoji:"‚ö´", nazev:"Siln√° teƒçka",
    q3:"P≈ôi uzav√≠r√°n√≠ rozhodnut√≠ neptat se 'Je to jasn√©?', ale 'Kdo c√≠t√≠, ≈æe jeho obavy nebyly vysly≈°eny?'." },
  { id:12, emoji:"üçÄ", nazev:"Navr√°cen√© ≈°tƒõst√≠",
    q3:"'Beru≈°ƒç√≠ ritu√°l': kdykoli nƒõkdo c√≠t√≠, ≈æe byl umlƒçen, polo≈æ√≠ beru≈°ku na st≈Øl. V≈°ichni zpomal√≠ a nechaj√≠ ho do≈ô√≠ct." }
];

document.getElementById('pohadka-text').textContent = POHADKA_TEXT;
document.getElementById('klic-uhlu-text').innerHTML = KLIC_UHLY.map(u => `
  <div class="klic-uhel">
    <strong>${u.id}. ${u.nazev}</strong>
    <em>${u.popis}</em>
  </div>
`).join('');

const SAVE_KEY = 'kocour_diagnostika_v1';

function ulozit() {
  const pocet = parseInt(document.getElementById('pocet-clenu').value) || 0;
  if (pocet < 1) return;
  const data = { pocet, clenove: [] };
  for (let i = 1; i <= pocet; i++) {
    const jEl = document.getElementById(`jmeno-${i}`);
    if (!jEl) continue;
    data.clenove.push({
      jmeno: jEl.value,
      o1: document.getElementById(`odpoved-${i}-1`)?.value || '',
      o2: document.getElementById(`odpoved-${i}-2`)?.value || '',
      o3: document.getElementById(`odpoved-${i}-3`)?.value || '',
      u1: document.getElementById(`uhel-${i}-1`)?.value || '',
      u2: document.getElementById(`uhel-${i}-2`)?.value || '',
      u3: document.getElementById(`uhel-${i}-3`)?.value || '',
    });
  }
  try { localStorage.setItem(SAVE_KEY, JSON.stringify(data)); } catch(e) {}
}

function nacistUlozene() {
  try {
    const raw = localStorage.getItem(SAVE_KEY);
    if (!raw) return;
    const data = JSON.parse(raw);
    if (!data?.pocet) return;
    document.getElementById('pocet-clenu').value = data.pocet;
    vytvorKartyHTML(data.pocet);
    data.clenove.forEach((c, idx) => {
      const i = idx + 1;
      const jEl = document.getElementById(`jmeno-${i}`);
      if (!jEl) return;
      jEl.value = c.jmeno || '';
      document.getElementById(`odpoved-${i}-1`).value = c.o1 || '';
      document.getElementById(`odpoved-${i}-2`).value = c.o2 || '';
      document.getElementById(`odpoved-${i}-3`).value = c.o3 || '';
      document.getElementById(`uhel-${i}-1`).value = c.u1 || '';
      document.getElementById(`uhel-${i}-2`).value = c.u2 || '';
      document.getElementById(`uhel-${i}-3`).value = c.u3 || '';
      aktualizujStav(i);
    });
    document.getElementById('tlacitko-vyhodnotit').style.display = 'block';
    document.getElementById('autosave-row').style.display = 'flex';
  } catch(e) {}
}

function smazatZapisnik() {
  if (!confirm('Opravdu vymazat cel√Ω z√°pisn√≠k? Tato akce nejde vr√°tit.')) return;
  try { localStorage.removeItem(SAVE_KEY); } catch(e) {}
  document.getElementById('karty-clenu').innerHTML = '';
  document.getElementById('tlacitko-vyhodnotit').style.display = 'none';
  document.getElementById('vysledky').style.display = 'none';
  document.getElementById('autosave-row').style.display = 'none';
}

function aktualizujStav(i) {
  const jmeno = document.getElementById(`jmeno-${i}`)?.value?.trim();
  const u1 = document.getElementById(`uhel-${i}-1`)?.value;
  const u2 = document.getElementById(`uhel-${i}-2`)?.value;
  const u3 = document.getElementById(`uhel-${i}-3`)?.value;
  const prirazeno = [u1, u2, u3].filter(Boolean).length;
  const nadpisEl = document.getElementById(`nadpis-${i}`);
  const stavEl = document.getElementById(`stav-${i}`);
  if (nadpisEl) nadpisEl.textContent = jmeno || `ƒålen ${i}`;
  if (stavEl) {
    if (prirazeno === 3) {
      stavEl.textContent = '‚úì hotovo';
      stavEl.className = 'clen-summary-stav stav-hotovo';
    } else if (prirazeno > 0) {
      stavEl.textContent = `${prirazeno}/3 p≈ôi≈ôazeno`;
      stavEl.className = 'clen-summary-stav';
    } else {
      stavEl.textContent = 'nevyplnƒõno';
      stavEl.className = 'clen-summary-stav';
    }
  }
}

const NAPOVEDA = '‚Üë My≈° vyb√≠r√° intuitivnƒõ podle j√°dra odpovƒõdi ‚Äî viz Kl√≠ƒç v√Ω≈°e';

function vytvorKartyHTML(pocet) {
  const options = uhly.map(u =>
    `<option value="${u.id}">${u.id}. ${u.emoji} ${u.nazev}</option>`
  ).join('');
  const sel = `<option value="">‚Äî nevybr√°no ‚Äî</option>${options}`;
  let html = '';
  for (let i = 1; i <= pocet; i++) {
    html += `
    <details class="clen-details" id="karta-${i}" open>
      <summary class="clen-summary">
        <span class="clen-summary-jmeno" id="nadpis-${i}">ƒålen ${i}</span>
        <span class="clen-summary-stav" id="stav-${i}">nevyplnƒõno</span>
      </summary>
      <div class="clen-telo">
        <div class="clen-hlavicka">
          <input class="clen-jmeno" type="text" id="jmeno-${i}"
            placeholder="jm√©no / inici√°ly (voliteln√©)"
            oninput="aktualizujStav(${i}); ulozit();">
        </div>
        <div class="otazka-radek">
          <label>Q1 ‚Äì Smysl (co ≈ôekl/a):</label>
          <textarea id="odpoved-${i}-1" placeholder="Zapi≈° odpovƒõƒè‚Ä¶" oninput="ulozit();"></textarea>
          <select id="uhel-${i}-1" onchange="aktualizujStav(${i}); ulozit();">${sel}</select>
          <span class="select-napoveda">${NAPOVEDA}</span>
        </div>
        <div class="otazka-radek">
          <label>Q2 ‚Äì Zaujet√≠ (co ≈ôekl/a):</label>
          <textarea id="odpoved-${i}-2" placeholder="Zapi≈° odpovƒõƒè‚Ä¶" oninput="ulozit();"></textarea>
          <select id="uhel-${i}-2" onchange="aktualizujStav(${i}); ulozit();">${sel}</select>
          <span class="select-napoveda">${NAPOVEDA}</span>
        </div>
        <div class="otazka-radek">
          <label>Q3 ‚Äì Aplikace (co ≈ôekl/a):</label>
          <textarea id="odpoved-${i}-3" placeholder="Zapi≈° odpovƒõƒè‚Ä¶" oninput="ulozit();"></textarea>
          <select id="uhel-${i}-3" onchange="aktualizujStav(${i}); ulozit();">${sel}</select>
          <span class="select-napoveda">${NAPOVEDA}</span>
        </div>
      </div>
    </details>`;
  }
  document.getElementById('karty-clenu').innerHTML = html;
}

function vytvorKarty() {
  const pocet = parseInt(document.getElementById('pocet-clenu').value);
  if (!pocet || pocet < 1) return;
  try { localStorage.removeItem(SAVE_KEY); } catch(e) {}
  vytvorKartyHTML(pocet);
  document.getElementById('tlacitko-vyhodnotit').style.display = 'block';
  document.getElementById('vysledky').style.display = 'none';
  document.getElementById('autosave-row').style.display = 'flex';
}

function vyhodnotit() {
  const pocet = parseInt(document.getElementById('pocet-clenu').value);
  const pocty = {};
  uhly.forEach(u => pocty[u.id] = { count:0, nazev:u.nazev, emoji:u.emoji, q3:u.q3 });
  let celkem = 0;
  const detailClenu = [];
  for (let i = 1; i <= pocet; i++) {
    const jmeno = document.getElementById(`jmeno-${i}`)?.value?.trim() || `ƒålen ${i}`;
    const uhlyClena = [];
    for (let q = 1; q <= 3; q++) {
      const val = document.getElementById(`uhel-${i}-${q}`)?.value;
      if (val) { pocty[val].count++; celkem++; uhlyClena.push(parseInt(val)); }
    }
    detailClenu.push({ jmeno, uhly: uhlyClena });
  }
  if (celkem === 0) { alert('P≈ôi≈ôaƒè aspo≈à jeden √∫hel p≈ôed vyhodnocen√≠m.'); return; }

  const pretizene = [], deficitni = [], vyvazene = [], nepouzite = [];
  uhly.forEach(u => {
    const p = pocty[u.id];
    p.procento = celkem > 0 ? p.count / celkem : 0;
    if (p.count === 0)           nepouzite.push(p);
    else if (p.procento >= 0.30) pretizene.push(p);
    else if (p.procento <= 0.10) deficitni.push(p);
    else                          vyvazene.push(p);
  });

  let html = `<h2>üß† Kognitivn√≠ mapa t√Ωmu</h2>`;
  html += `<p style="font-size:0.85rem;color:#555;margin-bottom:1rem;">Celkem p≈ôi≈ôazeno: <strong>${celkem}</strong> √∫hl≈Ø od <strong>${pocet}</strong> ƒçlen≈Ø</p>`;
  html += `<table class="mapa-tabulka"><tr><th>√öhel</th><th>Poƒçet</th><th>%</th><th>Typ</th></tr>`;
  uhly.map(u => pocty[u.id]).sort((a,b) => b.count - a.count).forEach(p => {
    const proc = Math.round(p.procento * 100);
    let typ = '‚óá vyv√°≈æen√Ω', trida = '';
    if (p.count === 0)           { typ = '‚Äî';           trida = 'deficitni'; }
    else if (p.procento >= 0.30) { typ = '‚ñ≤ p≈ôet√≠≈æen√Ω'; trida = 'pretizeny'; }
    else if (p.procento <= 0.10) { typ = '‚ñΩ deficitn√≠'; trida = 'deficitni'; }
    html += `<tr class="${trida}"><td>${p.emoji} ${p.nazev}</td><td>${p.count}√ó</td><td>${proc}%</td><td>${typ}</td></tr>`;
  });
  html += `</table>`;

  if (pretizene.length > 0) {
    html += `<div class="sekce-vysledku"><h3>‚ñ≤ P≈ôet√≠≈æen√© √∫hly (nad 30 %)</h3>`;
    html += `<p style="font-size:0.85rem;margin-bottom:0.7rem;">T√Ωm se d√≠v√° po≈ô√°d stejnƒõ. Co vid√≠, vid√≠ dob≈ôe. Co nevid√≠, neexistuje.</p>`;
    pretizene.forEach(p => {
      const protivahy = deficitni.concat(nepouzite).slice(0, 2);
      html += `<div class="uhel-vysledek"><strong>${p.emoji} ${p.nazev} ‚Äì ${p.count}√ó (${Math.round(p.procento*100)}%)</strong>`;
      if (protivahy.length > 0) {
        html += `<div class="uhel-doporuceni">Tr√©nink deficitu ‚Äî √∫kol pro lidi s t√≠mto √∫hlem:<br>`;
        protivahy.forEach(def => { html += `‚Üí <strong>${def.emoji} ${def.nazev}:</strong> ${def.q3}<br>`; });
        html += `</div>`;
      }
      html += `</div>`;
    });
    html += `</div>`;
  }

  const vsechnyDeficitni = deficitni.concat(nepouzite);
  if (vsechnyDeficitni.length > 0) {
    html += `<div class="sekce-vysledku"><h3>‚ñΩ Deficitn√≠ √∫hly (pod 10 % nebo v≈Øbec)</h3>`;
    html += `<p style="font-size:0.85rem;margin-bottom:0.7rem;">Slep√° m√≠sta. Perspektivy, kter√© t√Ωm nepou≈æ√≠v√°, i kdy≈æ by je pot≈ôeboval.</p>`;
    vsechnyDeficitni.forEach(p => {
      html += `<div class="uhel-vysledek"><strong>${p.emoji} ${p.nazev} ‚Äì ${p.count}√ó</strong>`;
      html += `<div class="uhel-doporuceni">N√°vrh √∫kolu: ${p.q3}</div></div>`;
    });
    html += `</div>`;
  }

  if (vyvazene.length > 0) {
    html += `<div class="sekce-vysledku"><h3>‚óá Vyv√°≈æen√© √∫hly ‚Äì mosty</h3>`;
    html += `<p style="font-size:0.85rem;margin-bottom:0.5rem;">Tito lid√© mohou b√Ωt tlumoƒçn√≠ky mezi perspektivami.</p>`;
    const idVyvazene = vyvazene.map(v => uhly.find(u => u.nazev === v.nazev)?.id);
    detailClenu.forEach(clen => {
      if (clen.uhly.some(uid => idVyvazene.includes(uid))) {
        html += `<span style="font-size:0.85rem;">‚Üí ${clen.jmeno} &nbsp;</span>`;
      }
    });
    html += `</div>`;
  }

  html += `<button class="btn btn-outline" style="margin-top:1rem;" onclick="window.print()">üñ® Vytisknout v√Ωsledky</button>`;
  const el = document.getElementById('vysledky');
  el.innerHTML = html;
  el.style.display = 'block';
  el.scrollIntoView({ behavior: 'smooth' });
}

window.addEventListener('DOMContentLoaded', nacistUlozene);
</script>

</body>
</html>
